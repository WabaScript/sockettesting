<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" type="text/css" href="public/style.css" />
        <title>simplesocket</title>
    </head>
    <body>
        <div id="container">
            <h1>Simple Socket</h1>
                <pre id="messages"></pre>
                <input 
                    id="message-input" 
                    type="text"
                    placeholder="Say something..." 
                />
                <div id="btn-container">
                    <button id="send-button" title="Send Message!">Send</button>
                    <button id="dark-mode-button" title="Enable Dark Mode!">Dark Mode</button>
                </div>
        </div>
        <!-- <script src="index.js"></script>  -->
        <script>
            // On pageload run this function
            (() => {
                const container = document.querySelector('#container');
                const sendButton = document.querySelector('#send-button');
                const messages = document.querySelector('#messages');
                const messageInput = document.querySelector('#message-input');
                const darkButton = document.querySelector('#dark-mode-button');

                let darkMode = false;
                let ws;

                const showMessage = (message) => {
                    messages.textContent += `\n\n${message}`;
                    messages.scrollTop = messages.scrollHeight;
                    messageInput.value = '';
                }

                const init = () => {
                    if (ws) {
                        ws.onerror = ws.onopen = ws.onclose = null;
                        ws.close();
                    }
                    // Sends a message to the server
                    ws = new WebSocket('ws://localhost:4000');
                    ws.onopen = () => {
                        console.log('connection opened!');
                    }
                    ws.onmessage = ({ data }) => showMessage(data);
                    ws.onclose = () => {
                        ws = null;
                    }
                }

                messageInput.addEventListener("keyup", e => {
                    if (e.key !== "Enter") return;   
                    if (!ws) {
                        showMessage("No Connection ðŸ˜±");
                        return;
                    }
                    ws.send(messageInput.value);
                    showMessage(messageInput.value);
                });

                sendButton.onclick = () => {
                    if (!ws) {
                        showMessage("No Connection ðŸ˜±");
                        return;
                    }
                    ws.send(messageInput.value);
                    showMessage(messageInput.value);
                }

                darkButton.onclick = () => {
                    darkMode = !darkMode
                    if (darkMode) {
                        document.body.classList.add('body-dark-active');
                        container.classList.add('container-dark-active');
                        sendButton.classList.add('send-button-dark-active');
                        messages.classList.add('messages-dark-active');
                        darkButton.classList.add('dark-mode-button-active');
                    }
                    else {
                        document.body.classList.remove('body-dark-active');
                        container.classList.remove('container-dark-active');
                        sendButton.classList.remove('send-button-dark-active');
                        messages.classList.remove('messages-dark-active');
                        darkButton.classList.remove('dark-mode-button-active');
                    }
                }
                // Invoke socket connection
                init();
            })();
        </script>
    </body>
</html>